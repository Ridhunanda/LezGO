<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LezGO - Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        .payment-method-section { display: none; }
        .active-method { display: block; }
        .method-btn { margin: 5px; }
        .test-hint { font-size: 0.8rem; color: #666; }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="homepage.html" class="logo">LezGO</a>
            <nav>
                <a href="homepage.html" class="nav-link">Back to Home</a>
            </nav>
        </div>
    </header>

    <div class="payment-container container mt-4">
        <h2 class="text-center mb-4">Payment Details</h2>

        <div id="message" class="alert" style="display: none;"></div>

        <form id="paymentForm">
            <div class="mb-3">
                <label for="customerID" class="form-label">Customer ID</label>
                <input type="text" class="form-control" id="customerID" placeholder="Enter Customer ID" required>
            </div>
            
            <div class="mb-3">
                <label for="bookingID" class="form-label">Booking ID</label>
                <input type="text" class="form-control" id="bookingID" placeholder="Enter Booking ID" required>
            </div>
            
            <div class="mb-3">
                <label for="amount" class="form-label">Amount (₹)</label>
                <input type="number" class="form-control" id="amount" min="1" placeholder="Enter amount" required>
                <div class="test-hint">Minimum ₹1 for test payments</div>
            </div>

            <div class="mb-4">
                <label class="form-label">Payment Method</label>
                <div class="d-flex flex-wrap">
                    <button type="button" class="btn btn-outline-primary method-btn active" data-method="upi">UPI</button>
                    <button type="button" class="btn btn-outline-primary method-btn" data-method="card">Credit/Debit Card</button>
                    <button type="button" class="btn btn-outline-primary method-btn" data-method="netbanking">Net Banking</button>
                    <button type="button" class="btn btn-outline-primary method-btn" data-method="wallet">Wallet</button>
                </div>
            </div>

            <!-- UPI Payment Section -->
            <div id="upi-section" class="payment-method-section active-method">
                <div class="mb-3">
                    <label for="upiID" class="form-label">UPI ID</label>
                    <input type="text" class="form-control" id="upiID" placeholder="e.g. success@razorpay">
                    <div class="test-hint">Test UPI IDs: success@razorpay (success), failure@razorpay (fail)</div>
                </div>
            </div>

            <!-- Card Payment Section -->
            <div id="card-section" class="payment-method-section">
                <div class="mb-3">
                    <label for="cardNumber" class="form-label">Card Number</label>
                    <input type="text" class="form-control" id="cardNumber" placeholder="4111 1111 1111 1111">
                    <div class="test-hint">Test cards: 4111 1111 1111 1111 (success), 4111 1111 1111 1112 (fail)</div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="cardExpiry" class="form-label">Expiry (MM/YY)</label>
                        <input type="text" class="form-control" id="cardExpiry" placeholder="12/30">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="cardCvv" class="form-label">CVV</label>
                        <input type="text" class="form-control" id="cardCvv" placeholder="123">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="cardName" class="form-label">Name on Card</label>
                    <input type="text" class="form-control" id="cardName" placeholder="Test User">
                </div>
            </div>

            <!-- Net Banking Section -->
            <div id="netbanking-section" class="payment-method-section">
                <div class="mb-3">
                    <label for="bank" class="form-label">Select Bank</label>
                    <select class="form-select" id="bank">
                        <option value="TEST">Test Bank (Always succeeds)</option>
                        <option value="FAIL">Test Bank (Always fails)</option>
                    </select>
                </div>
            </div>

            <!-- Wallet Section -->
            <div id="wallet-section" class="payment-method-section">
                <div class="mb-3">
                    <label for="walletType" class="form-label">Select Wallet</label>
                    <select class="form-select" id="walletType">
                        <option value="TEST">Test Wallet (Always succeeds)</option>
                        <option value="FAIL">Test Wallet (Always fails)</option>
                    </select>
                </div>
            </div>

            <button type="button" class="btn btn-success w-100 mt-3" id="rzp-button">Proceed to Pay</button>
        </form>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
                <a href="contact.html">Contact Us</a>
            </div>
            <div class="copyright">
                &copy; LezGO 2025. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Payment method selection
        document.querySelectorAll('.method-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Show corresponding section
                const method = this.dataset.method;
                document.querySelectorAll('.payment-method-section').forEach(section => {
                    section.classList.remove('active-method');
                });
                document.getElementById(${method}-section).classList.add('active-method');
            });
        });

        // Payment handler
        document.getElementById("rzp-button").addEventListener("click", async function() {
    const customerID = document.getElementById("customerID").value;
    const bookingID = document.getElementById("bookingID").value;
    const amount = document.getElementById("amount").value;
    const activeMethod = document.querySelector('.method-btn.active').dataset.method;

    if (!customerID || !bookingID || !amount || parseInt(amount) < 1) {
        showMessage("❌ Please fill all fields correctly (minimum ₹1)", "danger");
        return;
    }

    try {
        const testOrderId = "order_test_" + Math.random().toString(36).substr(2, 9);
        let shouldFail = false;

        // Check if we're testing a failure case
        if (activeMethod === 'upi' && document.getElementById("upiID").value.includes('failure')) {
            shouldFail = true;
        } 
        else if (activeMethod === 'card' && document.getElementById("cardNumber").value.includes('1112')) {
            shouldFail = true;
        }
        else if ((activeMethod === 'netbanking' || activeMethod === 'wallet') && 
                document.getElementById(activeMethod === 'netbanking' ? "bank" : "walletType").value === 'FAIL') {
            shouldFail = true;
        }

        const options = {
            "key": "rzp_test_1DP5mmOlF5G5ag",
            "amount": amount * 100,
            "currency": "INR",
            "name": "LezGO Rentals",
            "description": Payment for Booking ${bookingID},
            "order_id": testOrderId,
            "handler": function(response) {
                if (shouldFail) {
                    showMessage(
                        `⚠ Unexpected success! Test credentials should have failed<br>
                        Method: ${activeMethod.toUpperCase()}`,
                        "warning"
                    );
                } else {
                    showMessage(
                        `✅ Payment Successful!<br>
                        Method: ${activeMethod.toUpperCase()}<br>
                        Transaction ID: ${response.razorpay_payment_id}`,
                        "success"
                    );
                }
            },
            "modal": {
                "ondismiss": function() {
                    if (shouldFail) {
                        showMessage(
                            `❌ Payment Failed as expected<br>
                            Method: ${activeMethod.toUpperCase()}`,
                            "danger"
                        );
                    } else {
                        showMessage(
                            ⚠ Payment window closed unexpectedly,
                            "warning"
                        );
                    }
                }
            },
            // ... rest of your options ...
        };

        const rzp1 = new Razorpay(options);
        rzp1.open();

    } catch (error) {
        showMessage(❌ System Error: ${error.message}, "danger");
        console.error("Payment Error:", error);
    }
});

        function showMessage(text, type) {
            const messageDiv = document.getElementById("message");
            messageDiv.className = alert alert-${type};
            messageDiv.innerHTML = text;
            messageDiv.style.display = "block";
        }
    </script>
</body>
</html>